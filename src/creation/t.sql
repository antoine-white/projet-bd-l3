
CREATE TABLE  "EDITEURS" 
   (	"ID" NUMBER, 
	"NOM" VARCHAR2(20) COLLATE "USING_NLS_COMP" NOT NULL ENABLE, 
	"ADRESSE" VARCHAR2(100) COLLATE "USING_NLS_COMP" NOT NULL ENABLE, 
	"TELEPHONE" VARCHAR2(20) COLLATE "USING_NLS_COMP" NOT NULL ENABLE, 
	 PRIMARY KEY ("ID")
  USING INDEX  ENABLE
   )  DEFAULT COLLATION "USING_NLS_COMP"
/
CREATE OR REPLACE EDITIONABLE SYNONYM  "DBMS_XPLAN" FOR "LIVESQL"."ORACLE_SQL_USER_XPLAN"
/
CREATE OR REPLACE EDITIONABLE SYNONYM  "V$SESSION" FOR "LIVESQL"."ORACLE_SQL_USER_V$SESSION"
/
CREATE OR REPLACE EDITIONABLE SYNONYM  "V$SQL_PLAN_STATISTICS_ALL" FOR "LIVESQL"."ORACLE_SQL_USER_V$SQL_PLAN_S_A"
/

CREATE OR REPLACE EDITIONABLE TYPE  "MULTIMEDIA" AS OBJECT (  
 id           NUMBER,  
 title           VARCHAR2(30),  
 theme          VARCHAR2(50),  
 editor          NUMBER, -- reference editor TABLE2  
 MEMBER FUNCTION show RETURN VARCHAR2,  
 MEMBER FUNCTION typeDoc RETURN VARCHAR2  
)  
 NOT FINAL;
/
CREATE OR REPLACE EDITIONABLE TYPE BODY  "MULTIMEDIA" AS  
 MEMBER FUNCTION typeDoc RETURN VARCHAR2 IS  
 BEGIN  
   RETURN '';  
 END;  
-- function that can be overriden by subtypes  
 MEMBER FUNCTION show RETURN VARCHAR2 IS  
 BEGIN  
   RETURN 'Id: ' || TO_CHAR(id) || ', title: ' || title || ', theme : ' || theme || ', editor : ' || editor;  
 END;  
   
END;
/
CREATE OR REPLACE EDITIONABLE TYPE  "CD" UNDER multimedia (   
    duree NUMBER,    
    nb_sous_titre NUMBER,  
    OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2,   
    OVERRIDING MEMBER FUNCTION typeDoc RETURN VARCHAR2   
    );
/
CREATE OR REPLACE EDITIONABLE TYPE BODY  "CD" AS    
 OVERRIDING  MEMBER FUNCTION typeDoc RETURN VARCHAR2 IS    
 BEGIN    
   RETURN 'CD';    
 END;    
 OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2 IS    
 BEGIN    
   RETURN (SELF AS multimedia).show || ', duree : ' || TO_CHAR(duree) || ', nombre de sous titres : ' || TO_CHAR(nb_sous_titre) ;  
 END;    
     
END;
/

CREATE OR REPLACE EDITIONABLE TYPE  "DVD" UNDER multimedia (   
    duree NUMBER,    
    OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2,   
    OVERRIDING MEMBER FUNCTION typeDoc RETURN VARCHAR2   
    );
/
CREATE OR REPLACE EDITIONABLE TYPE BODY  "DVD" AS    
 OVERRIDING  MEMBER FUNCTION typeDoc RETURN VARCHAR2 IS    
 BEGIN    
   RETURN 'DVD';    
 END;    
 OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2 IS    
 BEGIN    
   RETURN (SELF AS multimedia).show || ', duree : ' || TO_CHAR(duree) ;  
 END;    
     
END;  
/

CREATE OR REPLACE EDITIONABLE TYPE  "LIVRE" UNDER multimedia (  
    nb_page NUMBER,   
    OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2,  
    OVERRIDING MEMBER FUNCTION typeDoc RETURN VARCHAR2  
    );  
/
CREATE OR REPLACE EDITIONABLE TYPE BODY  "LIVRE" AS    
 OVERRIDING  MEMBER FUNCTION typeDoc RETURN VARCHAR2 IS    
 BEGIN    
   RETURN 'Livre';    
 END;    
 OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2 IS    
 BEGIN    
   RETURN (SELF AS multimedia).show || ', nombre de page : ' || TO_CHAR(nb_page);    
 END;    
     
END;
/


CREATE OR REPLACE EDITIONABLE TYPE  "VIDEO" UNDER multimedia (   
    duree NUMBER,   
    format_enreg VARCHAR2(6),  
    OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2,   
    OVERRIDING MEMBER FUNCTION typeDoc RETURN VARCHAR2   
    );
/
CREATE OR REPLACE EDITIONABLE TYPE BODY  "VIDEO" AS    
 OVERRIDING  MEMBER FUNCTION typeDoc RETURN VARCHAR2 IS    
 BEGIN    
   RETURN 'VIDEO';    
 END;    
 OVERRIDING MEMBER FUNCTION show RETURN VARCHAR2 IS    
 BEGIN    
   RETURN (SELF AS multimedia).show || ', duree : ' || TO_CHAR(duree) || ', format d enregistrement : ' || format_enreg  ;  
 END;    
     
END;
/
CREATE TABLE DOCUMENTS of multimedia;
ALTER TABLE DOCUMENTS 
ADD CONSTRAINT constraint_id PRIMARY KEY (id);
/
ALTER TABLE DOCUMENTS  
ADD FOREIGN KEY (editor) 
REFERENCES EDITEURS(ID)
/
CREATE TABLE AUTEURS(
ID NUMBER NOT NULL PRIMARY KEY,
nom varchar2(20),
prenom varchar2(20),
date_naissance timestamp
);
/
CREATE TABLE AUTEURS_DOCUMENTS(
auteur_id NUMBER NOT NULL,
document_id NUMBER NOT NULL,
PRIMARY KEY (auteur_id,document_id),
FOREIGN KEY (auteur_id) references AUTEURS(ID),
FOREIGN KEY (document_id) references DOCUMENTS(ID)
);
/
CREATE TABLE DOCUMENTS_MEDIATHEQUE(
ID NUMBER NOT NULL PRIMARY KEY,
nb_total NUMBER NOT NULL,
nb_emprunte NUMBER NOT NULL,
rayon varchar2(40) NOT NULL,
document_id NUMBER NOT NULL,
FOREIGN KEY (document_id) references DOCUMENTS(ID)
);
/
CREATE TABLE EMPRUNTEURS(
ID NUMBER NOT NULL PRIMARY KEY,
nom varchar2(20) NOT NULL ,
prenom varchar2(20) NOT NULL ,
adresse VARCHAR2(100) NOT NULL , 
telephone VARCHAR2(20) NOT NULL,
categorie VARCHAR2(20) CHECK( categorie IN ('personnel', 'professionel', 'public'))
);
/
CREATE TABLE EMPRUNTS(
ID NUMBER NOT NULL PRIMARY KEY,
debut timestamp NOT NULL,
fin timestamp NOT NULL,
emprunteur_id NUMBER NOT NULL,
document_media_id NUMBER NOT NULL,
FOREIGN KEY (document_media_id) references DOCUMENTS_MEDIATHEQUE(ID),
FOREIGN KEY (emprunteur_id) references EMPRUNTEURS(ID)
);
/
CREATE TABLE MOT_CLES(
ID NUMBER NOT NULL PRIMARY KEY,
mot_cle varchar2(50) NOT NULL
);
/
CREATE TABLE MOT_CLES_DOCUMENTS(
ID NUMBER NOT NULL PRIMARY KEY,
mot_cle_id NUMBER NOT NULL,
document_id NUMBER NOT NULL,
FOREIGN KEY (document_id) references DOCUMENTS(ID),
FOREIGN KEY (mot_cle_id) references MOT_CLES(ID)
);
/
INSERT INTO EMPRUNTEURS 
VALUES(0,'xavier','batptiste','1 rue de la france poitiers','33606060606','personnel');
/
INSERT INTO EMPRUNTEURS
VALUES(1,'Gilles','Subrenat','2 rue de la france poitiers','33606060607','personnel');
/
INSERT INTO EMPRUNTEURS 
VALUES(2,'Laurant','David','7 rue de la france poitiers','33606060706','personnel');
/
INSERT INTO EMPRUNTEURS 
VALUES(3,'Mirianne','David','14 rue de la france poitiers','33606060906','personnel');
/
INSERT INTO EMPRUNTEURS 
VALUES(4,'Fany','David','24 rue de la france poitiers','33606090706','personnel');
/
INSERT INTO EMPRUNTEURS
VALUES(5,'françois','Dupond','2 rue de la france poitiers','33616060607','public');
/
INSERT INTO EMPRUNTEURS
VALUES(6,'Jeans','Levis','2 rue de la france poitiers','33616063607','public');
/
INSERT INTO EMPRUNTEURS
VALUES(7,'James','Durant','2 rue de la france poitiers','33616000607','public');
/
INSERT INTO EMPRUNTEURS
VALUES(8,'Myriam','Lavine','2 rue de la france poitiers','33615060607','public');
/
INSERT INTO EMPRUNTEURS
VALUES(9,'Abdul','Davis','2 rue de la france poitiers','33616060600','public');
/
INSERT INTO EMPRUNTEURS
VALUES(10,'René','Kou','24 rue de la france poitiers','33615060107','professionel');
/
INSERT INTO EMPRUNTEURS
VALUES(11,'goku','kakarot','7 rue de la france poitiers','33615960607','professionel');
/
INSERT INTO EMPRUNTEURS
VALUES(12,'Sylvie','Gerard','14 rue de la france poitiers','33615009607','professionel');
/
INSERT INTO EMPRUNTEURS
VALUES(13,'Killian','Tillie','5 rue de la france poitiers','33615000007','professionel');
/
INSERT INTO EMPRUNTEURS
VALUES(14,'John','Smith','2 rue de la france poitiers','33695060607','professionel');
/
INSERT INTO MOT_CLES
VALUES (0,'informatique')
/
INSERT INTO MOT_CLES
VALUES (1,'mathématiques')
/
INSERT INTO MOT_CLES
VALUES (2,'art')
/
INSERT INTO MOT_CLES
VALUES (3,'medecine')
/
INSERT INTO MOT_CLES
VALUES (4,'SQL')
/
INSERT INTO MOT_CLES
VALUES (5,'Base de donnes')
/
INSERT INTO EDITEURS
VALUES (0,'Eyrolles','1 rue de la souche','33998877908')
/
INSERT INTO EDITEURS
VALUES (1,'Dunod','90 rue de la souche','33998477908')
/
INSERT INTO EDITEURS
VALUES (2,'DeLuxe','40 rue de la souche','33998977908')
/
INSERT INTO AUTEURS
VALUES (0,'David','Jean',TO_TIMESTAMP('03-AUG-99 11:20:30.45 AM'))
/
INSERT INTO AUTEURS
VALUES (1,'Herbert','Killiam',TO_TIMESTAMP('09-AUG-90 01:00:00.00 AM'))
/
INSERT INTO AUTEURS
VALUES (2,'Molac','Yves',TO_TIMESTAMP('03-MAY-76 01:00:00.00 AM'))
/
INSERT INTO DOCUMENTS
VALUES (livre(0,'SQL pour les nuls','informatique',1,100))
/
INSERT INTO DOCUMENTS
VALUES (livre(1,'SQL avancé','informatique',1,1000))
/
INSERT INTO DOCUMENTS
VALUES (livre(2,'géométrie','mathématiques',0,50))
/
INSERT INTO DOCUMENTS
VALUES (livre(3,'géométrie avancée','mathématiques',0,500))
/
INSERT INTO DOCUMENTS
VALUES (livre(4,'algo simple','informatique',0,80))
/
INSERT INTO DOCUMENTS
VALUES (cd(5,'chanson bien','chanson',2,130,1))
/
INSERT INTO DOCUMENTS
VALUES (cd(6,'chanson vraiment bien','chanson',0,30,1))
/
INSERT INTO DOCUMENTS
VALUES (cd(7,'chant','chanson',2,100,1))
/
INSERT INTO DOCUMENTS
VALUES (cd(8,'chant religieux','chanson',0,100,1))
/
INSERT INTO DOCUMENTS
VALUES (dvd(9,'religieux','religion',1,100))
/
INSERT INTO DOCUMENTS
VALUES (dvd(10,'meutres sanglant','sang',2,180))
/
INSERT INTO DOCUMENTS
VALUES (video(11,'foot','football',1,180,'mp4'))
/
INSERT INTO DOCUMENTS
VALUES (video(12,'handball','hand',0,64,'mp4'))
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (0,0,0)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (1,0,1)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (2,0,4)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (3,4,1)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (4,4,0)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (5,5,0)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (6,5,1)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (7,1,3)
/
INSERT INTO MOT_CLES_DOCUMENTS
VALUES (8,1,4)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (0,1)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (0,2)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (1,4)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (1,3)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (0,5)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,6)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,7)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,8)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (1,8)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (0,8)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,9)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,10)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,11)
/
INSERT INTO AUTEURS_DOCUMENTS
VALUES (2,12)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (12,1,0,'video',12)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (11,1,0,'video',11)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (10,1,0,'cd/dvd',10)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (9,1,0,'cd/dvd',9)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (8,5,0,'cd/dvd',8)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (7,1,0,'cd/dvd',7)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (6,1,0,'cd/dvd',6)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (5,1,0,'cd/dvd',5)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (4,1,0,'science',4)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (3,3,0,'science',3)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (2,2,0,'science',2)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (1,2,0,'science',1)
/
INSERT INTO DOCUMENTS_MEDIATHEQUE 
VALUES (0,1,0,'science',0)
